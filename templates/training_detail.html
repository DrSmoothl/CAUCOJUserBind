{% extends "layout/basic.html" %}
{% block content %}
<style>
/* 全局重置 - 彻底移除Foundation约束 */
* {
  box-sizing: border-box;
}

.row, .row * {
  max-width: none !important;
}

/* 强制全宽度布局 */
.main, .main-content, .content, 
.section, .page, .page-content,
.medium-7, .medium-7.columns,
.columns, .column {
  width: 100% !important;
  max-width: 100% !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
  margin-left: 0 !important;
  margin-right: 0 !important;
  float: none !important;
  display: block !important;
}

/* 简洁的训练详情页面样式 */
.training-container {
  max-width: 100vw !important;
  width: calc(100vw - 40px) !important;
  margin: 0 auto !important;
  padding: 0 20px !important;
}

/* 强制移除所有可能的布局约束 */
body, html {
  margin: 0 !important;
  padding: 0 !important;
  width: 100% !important;
  overflow-x: auto !important;
}

.row {
  max-width: 100% !important;
  width: 100% !important;
  margin: 0 !important;
}

.medium-7.columns {
  width: 100% !important;
  max-width: 100% !important;
  float: none !important;
  display: block !important;
}

/* 调整网格布局以适应更大宽度 */
.training-main-content {
  width: 100% !important;
  max-width: 100% !important;
}

@media (min-width: 1200px) {
  .training-main-content.medium-7 {
    width: 75% !important;
    max-width: 1200px !important;
    flex: 0 0 75% !important;
  }
  
  .training-main-content.medium-9 {
    width: 80% !important;
    max-width: 1300px !important;
    flex: 0 0 80% !important;
  }
  
  .training-sidebar {
    width: 20% !important;
    min-width: 280px !important;
    flex: 0 0 20% !important;
  }
  
  .training-userlist {
    width: 12% !important;
    min-width: 180px !important;
    flex: 0 0 12% !important;
  }
}

@media (min-width: 1440px) {
  .training-main-content.medium-7 {
    width: 78% !important;
    max-width: 1400px !important;
    flex: 0 0 78% !important;
  }
  
  .training-main-content.medium-9 {
    width: 85% !important;
    max-width: 1500px !important;
    flex: 0 0 85% !important;
  }
  
  .training-sidebar {
    width: 18% !important;
    min-width: 300px !important;
    flex: 0 0 18% !important;
  }
  
  .training-userlist {
    width: 10% !important;
    min-width: 160px !important;
    flex: 0 0 10% !important;
  }
}

/* 训练问题表格响应式设计 */
.training__problems {
  overflow-x: auto !important;
  -webkit-overflow-scrolling: touch !important;
  width: 100% !important;
  max-width: 100% !important;
}

.training__problems .section__table-container {
  min-width: 100% !important;
  overflow-x: auto !important;
  width: 100% !important;
  max-width: 100% !important;
}

.training__problems .data-table {
  min-width: 1600px !important; /* 增加最小宽度 */
  width: 100% !important;
  table-layout: fixed !important; /* 改为固定布局 */
  max-width: 100% !important;
}

/* 调整列宽以适应大屏幕 */
.training__problems .col--status {
  width: 200px !important; /* 增加宽度 */
  min-width: 200px !important;
  max-width: 200px !important;
}

.training__problems .col--name {
  width: auto !important;
  min-width: 800px !important; /* 增加最小宽度 */
  max-width: none !important;
}

.training__problems .col--tried {
  width: 120px;
  min-width: 120px;
}

.training__problems .col--ac {
  width: 120px;
  min-width: 120px;
}

.training__problems .col--difficulty {
  width: 140px;
  min-width: 140px;
}

/* 题目名称样式优化 */
.training__problems .col--problem-name {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.training__problems .col--problem-name a {
  display: inline-block;
  max-width: calc(100% - 50px);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* 保持原有简洁风格的表格样式 */
.training__problems .data-table thead th {
  padding: 12px 16px;
}

.training__problems .data-table tbody td {
  padding: 10px 16px;
}

.training__problems .data-table tbody tr:hover {
  background-color: #f8f9fa;
}

/* 响应式设计 */
@media (max-width: 1440px) {
  .training-container {
    max-width: 1400px;
  }
  
  .training__problems .data-table {
    min-width: 1200px;
  }
  
  .training__problems .col--name {
    min-width: 500px;
  }
  
  .training__problems .col--status {
    width: 160px;
    min-width: 160px;
  }
}

@media (max-width: 1200px) {
  .training-container {
    max-width: 100%;
    padding: 0 15px;
  }
  
  .training-main-content.medium-7,
  .training-main-content.medium-9 {
    width: auto !important;
    max-width: none !important;
  }
  
  .training-sidebar {
    width: auto !important;
    min-width: auto !important;
  }
  
  .training-userlist {
    width: auto !important;
    min-width: auto !important;
  }
  
  .training__problems .data-table {
    min-width: 800px;
  }
  
  .training__problems .col--name {
    min-width: 300px;
  }
}

@media (max-width: 768px) {
  .training-container {
    padding: 0 10px;
  }
  
  .training__problems .data-table {
    min-width: 650px;
    font-size: 14px;
  }
  
  .training__problems .col--status {
    width: 120px;
    min-width: 120px;
  }
  
  .training__problems .col--name {
    min-width: 250px;
  }
  
  .training__problems .col--tried,
  .training__problems .col--ac {
    width: 80px;
    min-width: 80px;
  }
  
  .training__problems .col--difficulty {
    width: 100px;
    min-width: 100px;
  }
}

@media (max-width: 480px) {
  .training__problems .data-table {
    min-width: 550px;
    font-size: 12px;
  }
  
  .training__problems .col--name {
    min-width: 200px;
  }
  
  .training__problems .col--status {
    width: 100px;
    min-width: 100px;
  }
  
  .training__problems .col--tried,
  .training__problems .col--ac {
    width: 60px;
    min-width: 60px;
  }
  
  .training__problems .col--difficulty {
    width: 80px;
    min-width: 80px;
  }
}
</style>

<div class="training-container">
<div class="row" data-sticky-parent>
  {%- if Object.keys(udict).length -%}
  <div class="medium-2 columns mobile--hide training-userlist">
    <div data-sticky="large"><div class="section side">
      <ol class="menu">
        <li class="menu__item nojs--hide">
          <form method="get" id="searchForm">
            <select name="group" class="select"{% if not groups.length %} style="display:none"{% endif %}>
              <option value="all" selected>{{ _('All') }}</option>
              {% for group in groups %}
                <option value="{{ group.uids.join(',') }}">{{ group.name }}</option>
              {% endfor %}
            </select>
            <input name="uid" type="text" class="search__input textbox" placeholder="{{ _('Select User') }}">
          </form>
        </li>
        <ul class="enroll_user_menu">
        {%- for uid, udoc in udict -%}
        <li class="menu__item enroll_user_menu_item" data-uid="{{ uid }}" data-uname="{{ udoc.uname }}" {% if handler.user.hasPerm(perm.PERM_VIEW_DISPLAYNAME) and udoc.displayName %}data-displayname="{{ udoc.displayName }}"{% endif %}>
          <a href="./{{ tdoc._id }}?uid={{ uid }}" class="menu__link{% if (handler.request.query.uid or handler.user._id) == uid %} active{% endif %}">
            <span class="user-profile-link">
              <img class="small user-profile-avatar v-center" loading="lazy" src="{{ avatarUrl(udoc.avatar|default('')) }}" width="20" height="20">
              <span class="user-profile-name">
                {% if handler.user.hasPerm(perm.PERM_VIEW_DISPLAYNAME) and udoc.displayName and udoc.displayName != udoc.uname %}
                  {{ udoc.displayName }} ({{ udoc.uname }})
                {% else %}
                  {{ udoc.uname }}
                {% endif %}
              </span>
            </span>
          </a>
        </li>
        {%- endfor -%}
        </ul>
      </ol>
    </div></div>
  </div>
  <div class="medium-7 columns training-main-content">
  {%- else -%}
  <div class="medium-9 columns training-main-content">
  {%- endif -%}
    <div class="section">
      <div class="section__body typo">
        {{ tdoc['content'] }}
      </div>
      <div class="section__body typo richmedia">
        {% if not handler.user.hasPriv(PRIV.PRIV_USER_PROFILE) %}
          <blockquote class="typo note">
            <p>{{ _('Login to join training plan') }}</p>
          </blockquote>
        {% elif not tsdoc.enroll %}
          <blockquote class="typo note">
            <p>{{ _('page.training_detail.invalid_when_not_enrolled') }}</p>
          </blockquote>
        {% endif %}
        {{ tdoc.description|default('')|markdown|safe }}
      </div>
    </div>
    <div class="section">
      {% include "partials/training_detail.html" %}
    </div>
  </div>
  <div class="medium-3 columns training-sidebar" data-sticky="large">
    <div class="section side">
      <div>
        <ol class="menu">
        {% if not tsdoc['enroll'] and handler.user.hasPriv(PRIV.PRIV_USER_PROFILE) %}
          <li class="menu__item">
            <form action="" method="POST">
              <input type="hidden" name="operation" value="enroll">
              <button class="menu__link" type="submit">
                <span class="icon icon-add"></span> {{ _('Enroll Training') }}
              </button>
            </form>
          </li>
        {% endif %}
        {% if handler.user.own(tdoc) or handler.user.hasPerm(perm.PERM_EDIT_TRAINING) %}
          <li class="menu__item"><a class="menu__link" href="{{ url('training_edit', tid=tdoc.docId) }}">
            <span class="icon icon-edit"></span>  {{ _('Edit') }}
          </a></li>
          <li class="menu__item"><a class="menu__link" href="{{ url('training_files', tid=tdoc.docId) }}">
            <span class="icon icon-file"></span> {{ _('Files') }}
          </a></li>
        {% endif %}
          <li class="menu__item"><a class="menu__link" href="{{ url('wiki_help', anchor='training') }}">
            <span class="icon icon-help"></span> {{ _('Help') }}
          </a></li>
          <li class="menu__seperator"></li>
        </ol>
      </div>
      <div class="section__body typo">
        <dl class="large horizontal">
        {% if handler.user.hasPriv(PRIV.PRIV_USER_PROFILE) %}
          <dt>{{ _('Status') }}</dt><dd>{% if tsdoc['enroll'] %}{{ _('Completed' if tsdoc['done'] else 'In Progress') }}{% else %}{{ _('Not Enrolled') }}{% endif %}</dd>
        {% endif %}
          {% if tsdoc['enroll'] %}
          <dt>{{ _('Progress') }}</dt><dd>{{ _('Completed') }} {{ (100 * tsdoc['donePids']|length / pids|length)|round|int }}%</dd>
          {% endif %}
          <dt>{{ _('Enrollees') }}</dt><dd>{{ tdoc.attend|default(0) }}</dd>
          <dt>{{ _('Created By') }}</dt>
          <dd>{{ user.render_inline(udoc, badge=false) }}</dd>
        </dl>
      </div>
    </div>
    <div class="section side">
      <ol class="menu">
        {{ sidemenu.render_item('list', 'training_detail', {tid:tdoc._id}, label='tasks_list', menu_item='training_detail') }}
      </ol>
    </div>
  </div>
</div>
</div>
{% endblock %}